"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[291],{9291:(D,f,i)=>{i.r(f),i.d(f,{AddEmployeeModule:()=>S});var c=i(6814),u=i(1896),l=i(6223),v=i(3519),_=i.n(v),e=i(5879),x=i(8789),Z=i(3680),A=i(5986),h=i(8034),y=i(4170),F=i(2032),b=i(8525),k=i(2599),p=i(1545),G=i(617),g=i(292);function C(r,s){1&r&&(e.TgZ(0,"div",1)(1,"div",2)(2,"h5",3),e._uU(3,"Please add your business holding first"),e.qZA(),e.TgZ(4,"button",4),e._uU(5,"Add business holding"),e.qZA()()())}function T(r,s){1&r&&(e.TgZ(0,"mat-icon"),e._uU(1,"check"),e.qZA())}function U(r,s){if(1&r){const o=e.EpF();e.TgZ(0,"mat-checkbox",40),e.NdJ("change",function(){const m=e.CHM(o).$implicit,n=e.oxw(2);return e.KtG(n.updateRole(m))}),e._uU(1),e.qZA()}if(2&r){const o=s.$implicit,t=e.oxw(2);e.Q6J("checked",t.employeeFormGroup.value.roles.includes(o)),e.xp6(1),e.Oqu(o)}}function q(r,s){if(1&r){const o=e.EpF();e.TgZ(0,"mat-checkbox",40),e.NdJ("change",function(){const m=e.CHM(o).$implicit,n=e.oxw(2);return e.KtG(n.updateFirmId(m._id))}),e._uU(1),e.qZA()}if(2&r){const o=s.$implicit,t=e.oxw(2);e.Q6J("checked",t.employeeFormGroup.value.firm_ids.includes(o._id)),e.xp6(1),e.Oqu(o.name)}}function w(r,s){if(1&r&&(e.TgZ(0,"div",44)(1,"mat-form-field",12)(2,"mat-label"),e._uU(3),e.qZA(),e._UZ(4,"input",45),e.qZA()()),2&r){const o=s.$implicit;e.Q6J("formGroupName",s.index),e.xp6(3),e.hij("Salary given by ",null==o.value||null==o.value.firm_details?null:o.value.firm_details.name,""),e.xp6(1),e.MGl("placeholder","Salary given by ",null==o.value||null==o.value.firm_details?null:o.value.firm_details.name,"")}}function E(r,s){if(1&r&&(e.TgZ(0,"div",41)(1,"div",1)(2,"div",42)(3,"h6",26),e._uU(4),e.qZA()(),e.YNc(5,w,5,3,"div",43),e.qZA()()),2&r){const o=e.oxw(2);e.xp6(4),e.hij("Please enter ",o.userFormGroup.value.title+" "+o.userFormGroup.value.firstname+" "+o.userFormGroup.value.lastname,"'s salary by firm/s:"),e.xp6(1),e.Q6J("ngForOf",o.monthly_salary.controls)}}function I(r,s){if(1&r){const o=e.EpF();e.TgZ(0,"tr",46)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td")(4,"mat-slide-toggle",47),e.NdJ("change",function(a){const n=e.CHM(o).$implicit,d=e.oxw(2);return e.KtG(d.workDayHolidayChange(a,n))}),e.qZA()(),e.TgZ(5,"td")(6,"mat-form-field"),e._UZ(7,"input",48),e.TgZ(8,"mat-icon",49),e.NdJ("click",function(){const m=e.CHM(o).$implicit,n=e.MAs(11);return e.KtG(m.controls.from.disabled?"":n.open())}),e._uU(9,"watch_later"),e.qZA()(),e._UZ(10,"ngx-mat-timepicker",50,51),e.TgZ(12,"span",52),e._uU(13,"-"),e.qZA(),e.TgZ(14,"mat-form-field"),e._UZ(15,"input",53),e.TgZ(16,"mat-icon",49),e.NdJ("click",function(){const m=e.CHM(o).$implicit,n=e.MAs(19);return e.KtG(m.controls.to.disabled?"":n.open())}),e._uU(17,"watch_later"),e.qZA()(),e._UZ(18,"ngx-mat-timepicker",50,54),e.qZA()()}if(2&r){const o=s.$implicit,t=s.index,a=e.MAs(11),m=e.MAs(19);e.Q6J("formGroupName",t),e.xp6(2),e.Oqu(o.value.day),e.xp6(2),e.Q6J("checked",o.value.holiday),e.xp6(3),e.Q6J("ngxMatTimepicker",a),e.xp6(8),e.Q6J("ngxMatTimepicker",m)}}function N(r,s){if(1&r){const o=e.EpF();e.TgZ(0,"div",1)(1,"div",5)(2,"h5",6),e._uU(3),e.qZA()(),e.TgZ(4,"div",5)(5,"mat-horizontal-stepper",null,7),e.YNc(7,T,2,0,"ng-template",8),e.TgZ(8,"mat-step",9)(9,"div",10)(10,"div",11)(11,"mat-form-field",12)(12,"mat-label"),e._uU(13,"Select title"),e.qZA(),e.TgZ(14,"mat-select",13)(15,"mat-option",14),e._uU(16,"Mr."),e.qZA(),e.TgZ(17,"mat-option",15),e._uU(18,"Miss."),e.qZA(),e.TgZ(19,"mat-option",16),e._uU(20,"Mrs."),e.qZA()()()(),e.TgZ(21,"div",11)(22,"mat-form-field",12)(23,"mat-label"),e._uU(24,"Firstname"),e.qZA(),e._UZ(25,"input",17),e.qZA()(),e.TgZ(26,"div",11)(27,"mat-form-field",12)(28,"mat-label"),e._uU(29,"Lastname"),e.qZA(),e._UZ(30,"input",18),e.qZA()(),e.TgZ(31,"div",11)(32,"mat-form-field",12)(33,"mat-label"),e._uU(34,"Contact No."),e.qZA(),e._UZ(35,"input",19),e.qZA()(),e.TgZ(36,"div",11)(37,"mat-form-field",12)(38,"mat-label"),e._uU(39,"E-Mail"),e.qZA(),e._UZ(40,"input",20),e.qZA()(),e.TgZ(41,"div",11)(42,"mat-form-field",12)(43,"mat-label"),e._uU(44,"Password (For Employee login)"),e.qZA(),e._UZ(45,"input",21),e.qZA()(),e.TgZ(46,"div",22)(47,"button",23),e._uU(48,"Proceed"),e.qZA()()()(),e.TgZ(49,"mat-step",24)(50,"div",10)(51,"div",25)(52,"h6",26),e._uU(53),e.qZA(),e.TgZ(54,"mat-form-field",12),e._UZ(55,"input",27)(56,"mat-datepicker-toggle",28)(57,"mat-datepicker",null,29),e.qZA()(),e.TgZ(59,"div",5)(60,"h6",26),e._uU(61),e.qZA(),e.YNc(62,U,2,2,"mat-checkbox",30),e.qZA(),e.TgZ(63,"div",5)(64,"h6",26),e._uU(65),e.qZA(),e.YNc(66,q,2,2,"mat-checkbox",30),e.qZA(),e.YNc(67,E,6,2,"div",31),e.TgZ(68,"div",32)(69,"button",33),e._uU(70,"Previous step"),e.qZA(),e.TgZ(71,"button",23),e._uU(72,"Proceed"),e.qZA()()()(),e.TgZ(73,"mat-step",34)(74,"div",10)(75,"div",35)(76,"h6",36),e._uU(77),e.qZA(),e.TgZ(78,"table",37)(79,"thead")(80,"tr")(81,"th"),e._uU(82,"Day"),e.qZA(),e.TgZ(83,"th"),e._uU(84,"Holiday"),e.qZA(),e.TgZ(85,"th"),e._uU(86,"Shift timing"),e.qZA()()(),e.TgZ(87,"tbody"),e.YNc(88,I,20,5,"tr",38),e.qZA()()(),e.TgZ(89,"div",32)(90,"button",33),e._uU(91,"Previous step"),e.qZA(),e.TgZ(92,"button",39),e.NdJ("click",function(){e.CHM(o);const a=e.oxw();return e.KtG(a.saveEmployee())}),e._uU(93,"Save employee"),e.qZA()()()()()()()}if(2&r){const o=e.MAs(58),t=e.oxw();e.xp6(3),e.hij("",t.employeeFormGroup.value.employee_id?"Update":"Add"," Employee"),e.xp6(5),e.Q6J("stepControl",t.userFormGroup),e.xp6(1),e.Q6J("formGroup",t.userFormGroup),e.xp6(38),e.Q6J("disabled",!t.userFormGroup.valid),e.xp6(2),e.Q6J("stepControl",t.employeeFormGroup),e.xp6(1),e.Q6J("formGroup",t.employeeFormGroup),e.xp6(3),e.hij("Please select ",t.userFormGroup.value.title+" "+t.userFormGroup.value.firstname+" "+t.userFormGroup.value.lastname,"'s joining date:"),e.xp6(2),e.Q6J("matDatepicker",o),e.xp6(1),e.Q6J("for",o),e.xp6(5),e.hij("Please select ",t.userFormGroup.value.title+" "+t.userFormGroup.value.firstname+" "+t.userFormGroup.value.lastname,"'s roles:"),e.xp6(1),e.Q6J("ngForOf",t.api.employee_roles),e.xp6(3),e.hij("Please select in which firm/s ",t.userFormGroup.value.title+" "+t.userFormGroup.value.firstname+" "+t.userFormGroup.value.lastname," works:"),e.xp6(1),e.Q6J("ngForOf",t.ownFirms),e.xp6(1),e.Q6J("ngIf",t.monthly_salary.length>0),e.xp6(4),e.Q6J("disabled",!t.employeeFormGroup.valid),e.xp6(2),e.Q6J("stepControl",t.employeeFormGroup),e.xp6(1),e.Q6J("formGroup",t.employeeWorkDaysFormGroup),e.xp6(3),e.hij("Please provide ",t.userFormGroup.value.title+" "+t.userFormGroup.value.firstname+" "+t.userFormGroup.value.lastname,"'s Holidays and Working days with shift timings:"),e.xp6(11),e.Q6J("ngForOf",t.work_days.controls),e.xp6(4),e.Q6J("disabled",!t.employeeWorkDaysFormGroup.valid)}}const J=[{path:"",component:(()=>{class r{constructor(o,t,a){this.fb=o,this.api=t,this.router=a,this.ownFirms=[]}ngOnInit(){this.userFormGroup=this.fb.group({user_id:[""],title:["",l.kI.required],firstname:["",l.kI.required],lastname:["",l.kI.required],email:[""],password:[""],contact_no:["",l.kI.required]}),this.employeeFormGroup=this.fb.group({employee_id:[""],joining_date:["",l.kI.required],firm_ids:[[],l.kI.required],monthly_salary:this.fb.array([]),roles:[[],l.kI.required]}),this.employeeWorkDaysFormGroup=this.fb.group({work_days:this.fb.array([])}),this.api.weekDays.forEach(o=>{this.work_days.push(this.workDayFormGroup()),this.work_days.controls.at(-1).patchValue({day:o})}),this.getOwnFirms()}getOwnFirms(){$("#loading_overlay").show();let o={firm_ids:[]};this.api.loggedInUser.firms_with_roles.map(t=>o.firm_ids.push(t.firm_id)),this.api.getFirmsById(o).subscribe(t=>{this.ownFirms=200==t.status&&t.data.length>0?t.data:[],$("#loading_overlay").hide()})}updateRole(o){let t=this.employeeFormGroup.value.roles;-1!=t.findIndex(a=>a==o)?t.splice(t.findIndex(a=>a==o),1):t.push(o),this.employeeFormGroup.patchValue({roles:t})}updateFirmId(o){let t=this.employeeFormGroup.value.firm_ids;t.includes(o)?(t.splice(t.findIndex(a=>a==o),1),this.monthly_salary.removeAt(this.monthly_salary.value.findIndex(a=>a.firm_details._id==o))):(t.push(o),this.monthly_salary.push(this.monthlySalaryFormGroup()),this.monthly_salary.controls.at(-1).patchValue({firm_details:this.ownFirms.find(a=>a._id==o)})),this.employeeFormGroup.patchValue({firm_ids:t})}get monthly_salary(){return this.employeeFormGroup.get("monthly_salary")}monthlySalaryFormGroup(){return this.fb.group({firm_details:["",l.kI.required],salary:["",l.kI.required]})}get work_days(){return this.employeeWorkDaysFormGroup.get("work_days")}workDayFormGroup(){return this.fb.group({day:["",l.kI.required],holiday:[!1],from:["",l.kI.required],to:["",l.kI.required]})}workDayHolidayChange(o,t){o.checked?(t.patchValue({from:"",to:""}),t.get("from").disable(),t.get("to").disable(),t.get("from").clearValidators(),t.get("to").clearValidators()):(t.get("from").enable(),t.get("to").enable(),t.get("from").setValidators(l.kI.required),t.get("to").setValidators(l.kI.required)),t.get("from").updateValueAndValidity(),t.get("to").updateValueAndValidity()}saveEmployee(){$("#loading_overlay").show(),this.api.signUp(this.userFormGroup.value).subscribe(t=>{if(200==t.status){let a={user_id:t.data._id,firms_with_roles:[]};this.employeeFormGroup.value.firm_ids.forEach(m=>{a.firms_with_roles.push({firm_id:m,role:"employee"})}),this.api.updateUserData(a).subscribe(m=>{if(200==m.status){let n={user_id:t.data._id,joining_date:this.employeeFormGroup.value.joining_date,roles:this.employeeFormGroup.value.roles,monthly_salary_by_firms:[],work_days:this.employeeWorkDaysFormGroup.value.work_days,added_by:this.api.loggedInUser._id};this.monthly_salary.value.forEach(d=>{n.monthly_salary_by_firms.push({firm_id:d.firm_details._id,salary:d.salary})}),this.api.saveEmployee(n).subscribe(d=>{200==d.status?($("#loading_overlay").hide(),_().fire({icon:"success",title:"Employee added successfully",html:"Employee <label class='erp-button p-1 m-1 rounded text-white'>"+this.userFormGroup.value.title+" "+this.userFormGroup.value.firstname+" "+this.userFormGroup.value.lastname+"</label> added successfully."}).then(()=>{this.router.navigate(["/erp/employees"])})):($("#loading_overlay").hide(),this.errorRes(d.message))})}else $("#loading_overlay").hide(),this.errorRes(m.message)})}else $("#loading_overlay").hide(),this.errorRes(t.message)})}errorRes(o){_().fire({icon:"error",title:o})}}return r.\u0275fac=function(o){return new(o||r)(e.Y36(l.qu),e.Y36(x.s),e.Y36(u.F0))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-add-employee"]],decls:2,vars:2,consts:[["class","row m-0",4,"ngIf"],[1,"row","m-0"],[1,"col-sm-12","my-3","text-center"],[1,"alert","alert-danger"],["routerLink","/erp/add-own-firm",1,"btn","erp-button","mx-1"],[1,"col-sm-12","my-3"],[1,"rounded","p-2","text-center","bg-light","border","text-info"],["stepper",""],["matStepperIcon","edit"],["label","Personal Details",3,"stepControl"],[1,"row","m-0",3,"formGroup"],[1,"col-sm-4"],["appearance","fill",1,"w-100"],["formControlName","title"],["value","Mr."],["value","Miss."],["value","Mrs."],["matInput","","formControlName","firstname","type","text","placeholder","Firstname"],["matInput","","formControlName","lastname","type","text","placeholder","Lastname"],["matInput","","formControlName","contact_no","type","number","placeholder","Contact No."],["matInput","","formControlName","email","type","email","placeholder","E-Mail"],["matInput","","formControlName","password","type","text","placeholder","Password (Optional)"],[1,"col-sm-12","text-right"],["matStepperNext","",1,"btn","erp-button",3,"disabled"],["label","Official Details",3,"stepControl"],[1,"col-sm-6"],[1,"input-hint-heading"],["matInput","","formControlName","joining_date","placeholder","Joining date",3,"matDatepicker"],["matIconSuffix","",3,"for"],["picker",""],["class","mx-2",3,"checked","change",4,"ngFor","ngForOf"],["class","col-sm-12","formArrayName","monthly_salary",4,"ngIf"],[1,"col-sm-12","d-flex","justify-content-between"],["matStepperPrevious","",1,"btn","erp-button"],["label","Work Shifts",3,"stepControl"],[1,"col-sm-12","table-responsive-sm"],[1,"input-hint-heading","my-3"],["formArrayName","work_days",1,"table","remove-field-bottom-space"],[3,"formGroupName",4,"ngFor","ngForOf"],["matStepperNext","",1,"btn","erp-button",3,"disabled","click"],[1,"mx-2",3,"checked","change"],["formArrayName","monthly_salary",1,"col-sm-12"],[1,"col-sm-12","px-0"],["class","col-sm-6",3,"formGroupName",4,"ngFor","ngForOf"],[1,"col-sm-6",3,"formGroupName"],["matInput","","formControlName","salary","type","number",3,"placeholder"],[3,"formGroupName"],["formControlName","holiday",3,"checked","change"],["matInput","","placeholder","Shift start time","readonly","","formControlName","from",3,"ngxMatTimepicker"],["matSuffix","",1,"text-primary",3,"click"],["dottedMinutesInGap","","enableKeyboardInput",""],["pickerA",""],[1,"mx-2"],["matInput","","placeholder","Shift end time","readonly","","formControlName","to",3,"ngxMatTimepicker"],["pickerB",""]],template:function(o,t){1&o&&(e.YNc(0,C,6,0,"div",0),e.YNc(1,N,94,20,"div",0)),2&o&&(e.Q6J("ngIf",0==t.ownFirms.length),e.xp6(1),e.Q6J("ngIf",t.ownFirms.length>0))},dependencies:[c.sg,c.O5,Z.ey,A.oG,h.Mq,h.hl,h.nW,y.KE,y.hX,y.R9,F.Nt,b.gD,k.Rr,p.C0,p.Vq,p.Ic,p.fd,p.z9,G.Hw,g.ft,g.Bi,l.Fj,l.wV,l.JJ,l.JL,l.sg,l.u,l.x0,l.CE,u.rH]}),r})()}];let M=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[u.Bz.forChild(J),u.Bz]}),r})();var Q=i(500);let S=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[c.ez,Q.q,M]}),r})()}}]);