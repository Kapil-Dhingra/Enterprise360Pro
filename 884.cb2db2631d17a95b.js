"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[884],{9884:(z,_,a)=>{a.r(_),a.d(_,{PurchasesModule:()=>O});var c=a(6814),l=a(1896),f=a(9862),e=a(5879),m=a(8789),h=a(3680),d=a(8034),p=a(4170),g=a(2032),Z=a(8525),x=a(1476),u=a(6223);function T(n,o){1&n&&(e.TgZ(0,"q",17),e._uU(1,"Click here to open filters"),e.qZA())}function v(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",21)(1,"p",22),e._uU(2,"Searched: "),e.TgZ(3,"strong"),e._uU(4),e.qZA()(),e.TgZ(5,"button",23),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return s.filters.search.applied=!1,s.filters.search.keyword="",s.page=0,e.KtG(s.fetchPurchases())}),e._uU(6,"X"),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(4),e.Oqu(t.filters.search.keyword)}}function A(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",24)(1,"mat-form-field",25)(2,"mat-label"),e._uU(3,"Search by Invoice No., Vendor Name, Business Holding Name"),e.qZA(),e.TgZ(4,"input",26),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.filters.search.keyword=s)}),e.qZA()(),e.TgZ(5,"button",27),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return s.filters.search.applied=!0,s.page=0,e.KtG(s.fetchPurchases())}),e._uU(6,"Search"),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(4),e.Q6J("ngModel",t.filters.search.keyword),e.xp6(1),e.Q6J("disabled",!t.filters.search.keyword)}}function C(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",21)(1,"p",22),e._uU(2,"Filtered: "),e.TgZ(3,"strong"),e._uU(4),e.ALo(5,"date"),e.ALo(6,"date"),e.qZA()(),e.TgZ(7,"button",23),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return s.filters.date.applied=!1,s.filters.date.from="",s.filters.date.to="",s.page=0,e.KtG(s.fetchPurchases())}),e._uU(8,"X"),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(4),e.lnq(" ","purchase_date"==t.filters.date.type?"Purchase Date":"Added on"," (",e.xi3(5,3,t.filters.date.from,"dd.MM.yyyy")," - ",e.xi3(6,6,t.filters.date.to,"dd.MM.yyyy"),") ")}}function P(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",24)(1,"mat-form-field",25)(2,"mat-select",28),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.filters.date.type=s)}),e.TgZ(3,"mat-option",29),e._uU(4,"Filter by Purchase Date"),e.qZA(),e.TgZ(5,"mat-option",30),e._uU(6,"Filter by Added on"),e.qZA()()(),e.TgZ(7,"mat-form-field",25)(8,"input",31),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.filters.date.from=s)}),e.qZA(),e._UZ(9,"mat-datepicker-toggle",32)(10,"mat-datepicker",null,33),e.qZA(),e.TgZ(12,"mat-form-field",25)(13,"input",34),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.filters.date.to=s)}),e.qZA(),e._UZ(14,"mat-datepicker-toggle",32)(15,"mat-datepicker",null,35),e.qZA(),e.TgZ(17,"button",27),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return s.filters.date.applied=!0,s.page=0,e.KtG(s.fetchPurchases())}),e._uU(18,"Filter"),e.qZA()()}if(2&n){const t=e.MAs(11),i=e.MAs(16),s=e.oxw(2);e.xp6(2),e.Q6J("ngModel",s.filters.date.type),e.xp6(6),e.Q6J("matDatepicker",t)("ngModel",s.filters.date.from),e.xp6(1),e.Q6J("for",t),e.xp6(4),e.Q6J("matDatepicker",i)("ngModel",s.filters.date.to),e.xp6(1),e.Q6J("for",i),e.xp6(3),e.Q6J("disabled",!s.filters.date.from||!s.filters.date.to)}}function y(n,o){if(1&n&&(e.TgZ(0,"div",18),e.YNc(1,v,7,1,"div",19),e.YNc(2,A,7,2,"div",20),e.YNc(3,C,9,9,"div",19),e.YNc(4,P,19,8,"div",20),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.filters.search.applied),e.xp6(1),e.Q6J("ngIf",!t.filters.search.applied),e.xp6(1),e.Q6J("ngIf",t.filters.date.applied),e.xp6(1),e.Q6J("ngIf",!t.filters.date.applied)}}function M(n,o){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu("asc"===t.sortDir?"\u25b2":"\u25bc")}}function q(n,o){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu("asc"===t.sortDir?"\u25b2":"\u25bc")}}function b(n,o){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu("asc"===t.sortDir?"\u25b2":"\u25bc")}}function J(n,o){if(1&n&&(e.TgZ(0,"p",40),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij("Invoice No.: ",t.invoice_no,"")}}function U(n,o){if(1&n&&(e.TgZ(0,"p",40),e._uU(1),e.qZA()),2&n){const t=o.$implicit;e.xp6(1),e.Oqu(t.name)}}function w(n,o){if(1&n&&(e.TgZ(0,"tr")(1,"th",37),e._uU(2),e.qZA(),e.TgZ(3,"td")(4,"p",7),e._uU(5),e.qZA(),e.YNc(6,J,2,1,"p",38),e.qZA(),e.TgZ(7,"td"),e.YNc(8,U,2,1,"p",39),e.qZA(),e.TgZ(9,"td")(10,"p",40),e._uU(11),e.qZA(),e.TgZ(12,"p",40),e._uU(13),e.qZA(),e.TgZ(14,"p",40),e._uU(15),e.qZA()(),e.TgZ(16,"td"),e._uU(17),e.ALo(18,"date"),e.qZA(),e.TgZ(19,"td"),e._uU(20),e.ALo(21,"date"),e.qZA(),e.TgZ(22,"td")(23,"button",41),e._uU(24,"Open"),e.qZA()()()),2&n){const t=o.$implicit,i=o.index;e.xp6(2),e.Oqu(i+1),e.xp6(3),e.Oqu(t.vendor_id.name),e.xp6(1),e.Q6J("ngIf",t.invoice_no),e.xp6(2),e.Q6J("ngForOf",t.firm_ids),e.xp6(3),e.hij("Total amount: ",t.total_after_final_adjustment,""),e.xp6(2),e.hij("Paid amount: ",t.total_paid,""),e.xp6(2),e.hij("Remaining amount: ",t.total_after_final_adjustment-t.total_paid,""),e.xp6(2),e.Oqu(e.xi3(18,10,t.purchase_date,"dd/MM/yyyy")),e.xp6(3),e.Oqu(e.xi3(21,13,t.createdAt,"dd/MM/yyyy HH:mm:ss")),e.xp6(3),e.MGl("routerLink","/erp/purchase-details/",t._id,"")}}function F(n,o){if(1&n&&(e.ynx(0),e.YNc(1,w,25,16,"tr",36),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.listItems)}}function k(n,o){1&n&&(e.ynx(0),e.TgZ(1,"tr")(2,"td",42),e._uU(3,"No purchase entries found."),e.qZA()(),e.BQk())}const I=function(){return[5,10,25,100]},N=[{path:"",component:(()=>{class n{constructor(t){this.api=t,this.listItems=[],this.page=0,this.pageSize=10,this.sortField="createdAt",this.sortDir="desc",this.totalEntries=0,this.showFilters=!1,this.filters={search:{keyword:"",applied:!1},date:{type:"purchase_date",from:"",to:"",applied:!1}}}ngOnInit(){this.fetchPurchases()}sort(t){this.sortField==t?this.sortDir="asc"===this.sortDir?"desc":"asc":(this.sortField=t,this.sortDir="asc"),this.page=0,this.fetchPurchases()}fetchPurchases(){$("#loading_overlay").show();let t=[];this.api.loggedInUser.firms_with_roles.map(s=>t.push(s.firm_id));let i=(new f.LE).set("page",this.page).set("pageSize",this.pageSize).set("sortField",this.sortField).set("sortDir",this.sortDir).set("firmIds",t.join(","));this.filters.date.applied&&(i=i.set("dateFilterField",this.filters.date.type).set("fromDate",this.filters.date.from).set("toDate",this.filters.date.to)),this.filters.search.applied&&(i=i.set("search",this.filters.search.keyword)),this.api.getPurchases(i).subscribe(s=>{200==s.status?(this.totalEntries=s.data.total||0,this.listItems=s.data.items||[]):console.log(s.message),$("#loading_overlay").hide()})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(m.s))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-purchases"]],decls:38,vars:13,consts:[[1,"row","m-0"],[1,"col-sm-12","p-0"],[1,"heading-div-bg","rounded","p-2","d-flex","justify-content-between"],[1,"text-center","align-self-center","mb-0","text-secondary"],["routerLink","/erp/add-purchase",1,"btn","btn-sm","erp-button","align-self-center"],[1,"border-info","rounded"],["role","button",1,"w-100","bg-info","p-1",3,"click"],[1,"mb-0"],["class","font-size-sm",4,"ngIf"],["class","w-100 p-2 d-flex flex-wrap remove-field-bottom-space",4,"ngIf"],[1,"table-responsive-sm","mt-2"],[1,"table"],[1,"table-dark"],["scope","col"],["scope","col","role","button",3,"click"],[4,"ngIf"],[3,"length","pageSize","pageSizeOptions","showFirstLastButtons","pageIndex","page"],[1,"font-size-sm"],[1,"w-100","p-2","d-flex","flex-wrap","remove-field-bottom-space"],["class","d-flex align-items-center rounded border-info p-1 m-2",4,"ngIf"],["class","w-100 d-flex mb-2",4,"ngIf"],[1,"d-flex","align-items-center","rounded","border-info","p-1","m-2"],[1,"mb-0","mr-2"],[1,"btn","btn-sm","erp-button-danger",3,"click"],[1,"w-100","d-flex","mb-2"],["appearance","fill",1,"w-100","mr-2"],["type","text","placeholder","Search...","matInput","",3,"ngModel","ngModelChange"],[1,"btn","erp-button",3,"disabled","click"],[3,"ngModel","ngModelChange"],["value","purchase_date"],["value","createdAt"],["matInput","","placeholder","From Date",3,"matDatepicker","ngModel","ngModelChange"],["matIconSuffix","",3,"for"],["picker1",""],["matInput","","placeholder","To Date",3,"matDatepicker","ngModel","ngModelChange"],["picker2",""],[4,"ngFor","ngForOf"],["scope","row"],["class","mb-0 font-size-sm",4,"ngIf"],["class","mb-0 font-size-sm",4,"ngFor","ngForOf"],[1,"mb-0","font-size-sm"],[1,"btn","text-white","btn-info","shadow-sm",3,"routerLink"],["colspan","7",1,"text-center"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h6",3),e._uU(4,"Purchases"),e.qZA(),e.TgZ(5,"button",4),e._uU(6,"Add Purchase"),e.qZA()(),e.TgZ(7,"div",5)(8,"div",6),e.NdJ("click",function(){return i.showFilters=!i.showFilters}),e.TgZ(9,"h6",7),e._uU(10,"Filters: "),e.YNc(11,T,2,0,"q",8),e.qZA()(),e.YNc(12,y,5,4,"div",9),e.qZA(),e.TgZ(13,"div",10)(14,"table",11)(15,"thead",12)(16,"tr")(17,"th",13),e._uU(18,"#"),e.qZA(),e.TgZ(19,"th",13),e._uU(20,"Vendor"),e.qZA(),e.TgZ(21,"th",13),e._uU(22,"Received in"),e.qZA(),e.TgZ(23,"th",14),e.NdJ("click",function(){return i.sort("total_after_final_adjustment")}),e._uU(24,"Amount "),e.YNc(25,M,2,1,"span",15),e.qZA(),e.TgZ(26,"th",14),e.NdJ("click",function(){return i.sort("purchase_date")}),e._uU(27,"Purchase date "),e.YNc(28,q,2,1,"span",15),e.qZA(),e.TgZ(29,"th",14),e.NdJ("click",function(){return i.sort("createdAt")}),e._uU(30,"Added on "),e.YNc(31,b,2,1,"span",15),e.qZA(),e.TgZ(32,"th",13),e._uU(33,"Action"),e.qZA()()(),e.TgZ(34,"tbody"),e.YNc(35,F,2,1,"ng-container",15),e.YNc(36,k,4,0,"ng-container",15),e.qZA()(),e.TgZ(37,"mat-paginator",16),e.NdJ("page",function(r){return i.page=r.pageIndex,i.pageSize=r.pageSize,i.fetchPurchases()}),e.qZA()()()()),2&t&&(e.xp6(11),e.Q6J("ngIf",!i.showFilters),e.xp6(1),e.Q6J("ngIf",i.showFilters),e.xp6(13),e.Q6J("ngIf","total_after_final_adjustment"==i.sortField),e.xp6(3),e.Q6J("ngIf","purchase_date"==i.sortField),e.xp6(3),e.Q6J("ngIf","createdAt"==i.sortField),e.xp6(4),e.Q6J("ngIf",i.listItems.length>0),e.xp6(1),e.Q6J("ngIf",0==i.listItems.length),e.xp6(1),e.Q6J("length",i.totalEntries)("pageSize",i.pageSize)("pageSizeOptions",e.DdM(12,I))("showFirstLastButtons",!0)("pageIndex",i.page))},dependencies:[c.sg,c.O5,h.ey,d.Mq,d.hl,d.nW,p.KE,p.hX,p.R9,g.Nt,Z.gD,x.NW,u.Fj,u.JJ,u.On,l.rH,c.uU]}),n})()}];let Q=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[l.Bz.forChild(N),l.Bz]}),n})();var D=a(500);let O=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[c.ez,D.q,Q]}),n})()}}]);