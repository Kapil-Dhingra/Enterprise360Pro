"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[286],{3286:(V,c,r)=>{r.r(c),r.d(c,{AddVendorModule:()=>b});var s=r(6814),m=r(1896),a=r(6223),f=r(3519),p=r.n(f),o=r(5879),h=r(8789),_=r(5986),v=r(4170),g=r(2032);function Z(t,l){1&t&&(o.TgZ(0,"div",2)(1,"div",3)(2,"h5",4),o._uU(3,"Please add your business holding first"),o.qZA(),o.TgZ(4,"button",5),o._uU(5,"Add business holding"),o.qZA()()())}function A(t,l){if(1&t){const e=o.EpF();o.TgZ(0,"mat-checkbox",25),o.NdJ("change",function(){const i=o.CHM(e).$implicit,u=o.oxw(2);return o.KtG(u.updateFirmId(i._id))}),o._uU(1),o.qZA()}if(2&t){const e=l.$implicit,d=o.oxw(2);o.Q6J("checked",d.vendorFormGroup.value.firm_ids.includes(e._id)),o.xp6(1),o.Oqu(e.name)}}function y(t,l){if(1&t){const e=o.EpF();o.TgZ(0,"div",6)(1,"div",7)(2,"h5",8),o._uU(3),o.qZA()(),o.TgZ(4,"div",9)(5,"mat-form-field",10)(6,"mat-label"),o._uU(7,"Vendor Name"),o.qZA(),o._UZ(8,"input",11),o.qZA()(),o.TgZ(9,"div",9)(10,"mat-form-field",10)(11,"mat-label"),o._uU(12,"GST No."),o.qZA(),o._UZ(13,"input",12),o.qZA()(),o.TgZ(14,"div",9)(15,"mat-form-field",10)(16,"mat-label"),o._uU(17,"Contact No."),o.qZA(),o._UZ(18,"input",13),o.qZA()(),o.TgZ(19,"div",9)(20,"mat-form-field",10)(21,"mat-label"),o._uU(22,"Street"),o.qZA(),o._UZ(23,"input",14),o.qZA()(),o.TgZ(24,"div",9)(25,"mat-form-field",10)(26,"mat-label"),o._uU(27,"Locality/Area"),o.qZA(),o._UZ(28,"input",15),o.qZA()(),o.TgZ(29,"div",9)(30,"mat-form-field",10)(31,"mat-label"),o._uU(32,"City/Town"),o.qZA(),o._UZ(33,"input",16),o.qZA()(),o.TgZ(34,"div",9)(35,"mat-form-field",10)(36,"mat-label"),o._uU(37,"State/Union Territory"),o.qZA(),o._UZ(38,"input",17),o.qZA()(),o.TgZ(39,"div",9)(40,"mat-form-field",10)(41,"mat-label"),o._uU(42,"Pincode/Postal Code"),o.qZA(),o._UZ(43,"input",18),o.qZA()(),o.TgZ(44,"div",9)(45,"mat-form-field",10)(46,"mat-label"),o._uU(47,"Country"),o.qZA(),o._UZ(48,"input",19),o.qZA()(),o.TgZ(49,"div",20)(50,"h6",21),o._uU(51,"Please select the business holdings which are associated with this vendor:"),o.qZA(),o.YNc(52,A,2,2,"mat-checkbox",22),o.qZA(),o.TgZ(53,"div",23)(54,"button",24),o.NdJ("click",function(){o.CHM(e);const n=o.oxw();return o.KtG(n.saveVendor())}),o._uU(55),o.qZA()()()}if(2&t){const e=o.oxw();o.Q6J("formGroup",e.vendorFormGroup),o.xp6(3),o.hij("",e.vendorFormGroup.value.vendor_id?"Update":"Add"," vendor"),o.xp6(49),o.Q6J("ngForOf",e.ownFirms),o.xp6(2),o.Q6J("disabled",!e.vendorFormGroup.valid),o.xp6(1),o.hij("",e.vendorFormGroup.value.vendor_id?"Update":"Save"," vendor")}}const F=[{path:"",component:(()=>{class t{constructor(e,d,n,i){this.api=e,this.fb=d,this.route=n,this.router=i,this.ownFirms=[],this.existing_vendor_data={}}ngOnInit(){this.vendorFormGroup=this.fb.group({vendor_id:[""],name:["",a.kI.required],gst_no:[""],contactno:[""],street:[""],locality:[""],city:["",a.kI.required],state:["",a.kI.required],pinCode:["",a.kI.required],country:["",a.kI.required],firm_ids:[[],a.kI.required]}),this.route.params.subscribe(e=>{e.vendor_id&&(this.vendorFormGroup.patchValue({vendor_id:e.vendor_id}),this.getVendorById())}),this.getOwnFirms()}getOwnFirms(){$("#loading_overlay").show();let e={firm_ids:[]};this.api.loggedInUser.firms_with_roles.map(d=>e.firm_ids.push(d.firm_id)),this.api.getFirmsById(e).subscribe(d=>{this.ownFirms=200==d.status&&d.data.length>0?d.data:[],$("#loading_overlay").hide()})}getVendorById(){$("#loading_overlay").show(),this.api.getVendorById(this.vendorFormGroup.value.vendor_id).subscribe(e=>{this.existing_vendor_data=e;let d=[];e.vendor_of.map(n=>d.push(n.firm_id)),this.vendorFormGroup.patchValue({name:e.name,gst_no:e.gst_no,contactno:e.contactno,street:e.street,locality:e.locality,city:e.city,state:e.state,pinCode:e.pinCode,country:e.country,firm_ids:d}),$("#loading_overlay").hide()})}saveVendor(){$("#loading_overlay").show();let e=this.vendorFormGroup.value.vendor_id?"updateVendor":"addVendor",d=this.vendorFormGroup.value,n=[];if(this.vendorFormGroup.value.firm_ids.map(i=>n.push({firm_id:i,date:new Date})),"updateVendor"==e)for(let i=this.existing_vendor_data.vendor_of.length-1;i>=0;i--)this.vendorFormGroup.value.firm_ids.includes(this.existing_vendor_data.vendor_of[i].firm_id)&&(n[n.findIndex(u=>u.firm_id==this.existing_vendor_data.vendor_of[i].firm_id)].date=this.existing_vendor_data.vendor_of[i].date);d.vendor_of=n,"addVendor"==e&&(d.added_by=this.api.loggedInUser._id),this.api[e](this.vendorFormGroup.value).subscribe(i=>{$("#loading_overlay").hide(),200==i.status?p().fire({icon:"success",title:"Vendor "+(this.vendorFormGroup.value.vendor_id?"updated":"added")+" successfully.",html:"Your Vendor <label class='erp-button p-1 m-1 rounded text-white'>"+this.vendorFormGroup.value.name+"</label> "+(this.vendorFormGroup.value.vendor_id?"Updated":"added")+" successfully."}).then(()=>{this.vendorFormGroup.value.vendor_id&&this.router.navigate(["/erp/vendors"]),this.vendorFormGroup.reset(),this.vendorFormGroup.patchValue({firm_ids:[]})}):p().fire({icon:"error",text:"Something went wrong."})})}updateFirmId(e){let d=this.vendorFormGroup.value.firm_ids;d.includes(e)?d.splice(d.findIndex(n=>n==e),1):d.push(e),this.vendorFormGroup.patchValue({firm_ids:d})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(h.s),o.Y36(a.qu),o.Y36(m.gz),o.Y36(m.F0))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-add-vendor"]],decls:2,vars:2,consts:[["class","row m-0",4,"ngIf"],["class","row m-0",3,"formGroup",4,"ngIf"],[1,"row","m-0"],[1,"col-sm-12","my-3","text-center"],[1,"alert","alert-danger"],["routerLink","/erp/add-own-firm",1,"btn","erp-button"],[1,"row","m-0",3,"formGroup"],[1,"col-sm-12","my-3"],[1,"rounded","p-2","text-center","bg-light","border","text-info"],[1,"col-sm-6","mb-2"],["appearance","fill",1,"w-100"],["placeholder","Vendor Name","matInput","","formControlName","name"],["placeholder","GST No.","matInput","","formControlName","gst_no"],["placeholder","Contact No.","matInput","","formControlName","contactno"],["placeholder","Street","matInput","","formControlName","street"],["placeholder","Locality/Area","matInput","","formControlName","locality"],["placeholder","City/Town","matInput","","formControlName","city"],["placeholder","State/Union Territory","matInput","","formControlName","state"],["placeholder","Pincode/Postal Code","matInput","","formControlName","pinCode"],["placeholder","Country","matInput","","formControlName","country"],[1,"col-sm-12","mb-2"],[1,"text-secondary"],["class","mx-2",3,"checked","change",4,"ngFor","ngForOf"],[1,"col-sm-12","text-right"],[1,"btn","erp-button",3,"disabled","click"],[1,"mx-2",3,"checked","change"]],template:function(e,d){1&e&&(o.YNc(0,Z,6,0,"div",0),o.YNc(1,y,56,5,"div",1)),2&e&&(o.Q6J("ngIf",0==d.ownFirms.length),o.xp6(1),o.Q6J("ngIf",d.ownFirms.length>0))},dependencies:[s.sg,s.O5,_.oG,v.KE,v.hX,g.Nt,a.Fj,a.JJ,a.JL,a.sg,a.u,m.rH]}),t})()}];let x=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[m.Bz.forChild(F),m.Bz]}),t})();var C=r(500);let b=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[s.ez,C.q,x]}),t})()}}]);